---
- name: Make the data directory for storing fetched quotes
  file:
    path: "{{ docker_dir }}/{{ container_name }}/quotes"
    state: directory
    recurse: false
    owner: "{{ username }}"
    group: "{{ username }}"
    mode: 0755

- name: Make sure that the quotes-api container is running
  docker_container:
    image: "bluefog/svalbard:quotes-api-latest"
    name: "{{ container_name }}"
    pull: yes
    restart_policy: unless-stopped
    networks:
      - name: traefik-proxy
    published_ports:
      - "8008:8008"
    env:
      "QUOTES_EXPORT_DIR": "/quotes-export"
    volumes:
      - "{{ docker_dir }}/{{ container_name }}/quotes:/quotes-export"
    labels:
      "traefik.enable": "true"
      "traefik.docker.network": "traefik-proxy"

      "traefik.http.routers.quotes.rule": "Host(`{{ container_name }}.{{ host }}`)"
      "traefik.http.services.quotes.loadbalancer.server.port": "8008"


      "traefik.http.routers.quotes.middlewares": "corsheader@file"